digraph SUPERPOWERS {
    rankdir=TB;
    node [fontname="Helvetica", fontsize=11, style=filled, fillcolor=white];
    edge [fontname="Helvetica", fontsize=9];
    nodesep=0.4;
    ranksep=0.5;

    // ===== ENTRY =====
    start [label="New task", shape=doublecircle, fillcolor="#e8f5e9"];

    // ===== ROUTING =====
    subgraph cluster_routing {
        label="Skill Routing";
        style=filled; fillcolor=white;

        route [label="What task?", shape=diamond];

        { rank=same;
            tdd [label="TDD", shape=box, fillcolor="#c8e6c9"];
            debug [label="Debugging", shape=box, fillcolor="#ffe0b2"];
            interop [label="janus-interop", shape=box, fillcolor="#b2ebf2"];
            other [label="Other skills", shape=box, fillcolor="#e1bee7"];
        }
    }

    // ===== WORK LOOP =====
    subgraph cluster_work {
        label="Work Loop";
        style=filled; fillcolor=white;

        work [label="Do work", shape=box];
        test [label="Test", shape=box];
        result [label="Expected\nresult?", shape=diamond];
    }

    done [label="Done", shape=doublecircle, fillcolor="#c8e6c9"];

    // ===== CONFUSION POINT =====
    confused [label="CONFUSED", shape=ellipse, fillcolor="#ffccbc"];
    triggers [label="Triggers:\n• Surprise result\n• Same error twice\n• 2nd failed fix", shape=note, fillcolor="#fff9c4"];

    // ===== JANUS REASONING (below confusion) =====
    subgraph cluster_janus {
        label="janus-reasoning";
        style=filled; fillcolor="#fff3e0";

        janus_start [label="STOP\nguessing", shape=octagon, fillcolor="#ff8a65", fontcolor=white];

        prompts [label="Complete ALL prompts:\n─────────────────\n1. Expected vs Observed\n2. Semantic: reminds me of...\n3. Symbolic: if X then Y...\n4. Compare: agree/conflict?\n5. ONE hypothesis (cite source)\n6. Track paradigms tried", shape=box, fillcolor="#ffe0b2"];

        quality [label="Derived?", shape=diamond];

        { rank=same;
            derived [label="DERIVED\n(cites evidence)", shape=box, fillcolor="#c8e6c9"];
            guess [label="GUESSED\n(no evidence)", shape=octagon, fillcolor=red, fontcolor=white];
        }

        one_change [label="ONE change", shape=box, fillcolor="#a5d6a7"];
    }

    // ===== SELF-CHECK =====
    selfcheck [label="Self-check:\n• Trying variations?\n• No constraints stated?\n• 'Maybe' without evidence?\n→ You are confused", shape=note, fillcolor="#ffcdd2"];

    // ===== NEVER =====
    subgraph cluster_never {
        label="NEVER";
        style=filled; fillcolor="#ffcdd2";
        { rank=same;
            n1 [label="Guess without\nderivation", shape=octagon, fillcolor=red, fontcolor=white];
            n2 [label="Multiple changes\nat once", shape=octagon, fillcolor=red, fontcolor=white];
            n3 [label="Skip symbolic\nreasoning", shape=octagon, fillcolor=red, fontcolor=white];
        }
    }

    // ===== MAIN FLOW (top to bottom) =====
    start -> route;

    route -> tdd [label="implement"];
    route -> debug [label="bug"];
    route -> interop [label="Prolog/Python"];
    route -> other [label="design/etc"];

    tdd -> work;
    debug -> work;
    interop -> work;
    other -> work;

    work -> test;
    test -> result;
    result -> done [label="yes"];

    // ===== CONFUSION BRANCH (flows down) =====
    result -> confused [label="no"];
    confused -> triggers [style=dotted, arrowhead=none];
    confused -> janus_start [style=bold, color="#d32f2f"];

    // ===== JANUS FLOW (down then back up) =====
    janus_start -> prompts;
    prompts -> quality;
    quality -> derived [label="cites source"];
    quality -> guess [label="no evidence"];
    guess -> prompts [label="redo"];
    derived -> one_change;

    // ===== RETURN TO TEST (clean backflow) =====
    one_change -> test [style=dashed, constraint=false, label="retry"];

    // ===== SELF-CHECK POINTS TO CONFUSED =====
    selfcheck -> confused [style=dotted, color="#d32f2f", constraint=false];
}
